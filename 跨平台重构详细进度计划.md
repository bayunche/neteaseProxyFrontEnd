# 音乐播放器跨平台重构详细进度计划

> **重要提醒**: 每完成一个阶段的任务后，请在对应的任务后面添加 `✅ 已完成 - YYYY-MM-DD` 标记，并更新完成状态。

## 📋 项目概述

基于当前网易云音乐风格播放器项目，实施跨平台重构，支持 Web、React Native 和 Electron 平台。

**预计总工期**: 12-16周  
**代码复用率**: 预计85%  
**开始时间**: 待定  
**当前状态**: 规划阶段

---

## 🏗️ 阶段一：基础架构搭建 (2-3周)

### 1.1 Monorepo 环境搭建
- [ ] **创建根目录结构** (1天)
  - [ ] 初始化根package.json配置
  - [ ] 设置workspaces配置
  - [ ] 配置ESLint和Prettier共享规则
  - [ ] 设置TypeScript项目引用

- [ ] **包结构创建** (0.5天)
  ```
  music-player-universal/
  ├── packages/
  │   ├── shared/
  │   ├── web/
  │   └── mobile/
  ├── tools/
  └── apps/
  ```

- [ ] **构建工具配置** (1天)
  - [ ] 配置Turborepo或Lerna
  - [ ] 设置统一的构建脚本
  - [ ] 配置热更新和开发环境

### 1.2 共享代码包 (packages/shared) 迁移

#### 1.2.1 类型定义迁移 (0.5天)
- [ ] **迁移核心类型** (`src/types/index.ts`)
  - [ ] Song, Album, Artist, Playlist类型
  - [ ] PlayMode, PlaybackState枚举
  - [ ] UserSettings, Lyrics类型
  - [ ] API响应类型
  - [ ] 搜索和统计相关类型

#### 1.2.2 工具函数迁移 (0.5天)
- [ ] **迁移工具函数** (`src/utils/`)
  - [ ] `cn.ts` - className工具函数
  - [ ] `audioGenerator.ts` - 音频生成工具
  - [ ] 时间格式化函数
  - [ ] 数据处理工具函数

#### 1.2.3 常量定义迁移 (0.5天)
- [ ] **创建constants目录**
  - [ ] API端点常量
  - [ ] 应用配置常量
  - [ ] 缓存键常量
  - [ ] 错误码定义

#### 1.2.4 API服务层迁移 (2天)
- [ ] **核心API服务迁移**
  - [ ] `NetEaseAPI.ts` - 网易云API基础类
  - [ ] `AuthAPI.ts` - 用户认证服务
  - [ ] `SearchAPI.ts` - 搜索服务
  - [ ] `PlaylistAPI.ts` - 歌单管理服务
  - [ ] `PlaylistAPI.enhanced.ts` - 增强版歌单API
  - [ ] `LyricAPI.ts` - 歌词服务
  - [ ] `SongAPI.ts` - 歌曲服务

- [ ] **API配置和工具**
  - [ ] `config.ts` - API配置
  - [ ] `utils.ts` - API工具函数
  - [ ] `types.ts` - API类型定义
  - [ ] `base.ts` - API基础类

#### 1.2.5 业务服务层迁移 (2天)
- [ ] **统计服务迁移**
  - [ ] `StatsService.ts` - 播放统计服务

- [ ] **音频服务抽象层创建**
  - [ ] 创建 `AudioServiceInterface.ts` 音频服务接口
  - [ ] 抽象 `AudioEngine` 接口
  - [ ] 迁移 `AudioEventManager.ts` 事件管理器
  - [ ] 创建平台适配器接口

#### 1.2.6 状态管理迁移 (2天)
- [ ] **Zustand Store迁移**
  - [ ] 迁移完整的store逻辑 (`src/stores/index.ts`)
  - [ ] 分离平台相关的Actions
  - [ ] 创建平台适配的Hook接口
  - [ ] 保持所有业务逻辑不变

### 1.3 平台检测和适配器 (1天)
- [ ] **创建平台检测工具**
  - [ ] `PlatformDetector.ts` - 运行环境检测
  - [ ] `PlatformConfig.ts` - 平台特定配置

- [ ] **创建适配器接口**
  - [ ] `StorageAdapter.ts` - 存储适配器接口
  - [ ] `AudioAdapter.ts` - 音频适配器接口
  - [ ] `NavigationAdapter.ts` - 导航适配器接口

---

## 🌐 阶段二：Web平台重构 (3-4周)

### 2.1 Web包基础搭建 (packages/web) (1天)
- [ ] **初始化Web包**
  - [ ] 创建package.json和依赖配置
  - [ ] 配置Vite构建系统
  - [ ] 设置TypeScript配置
  - [ ] 引入shared包依赖

### 2.2 平台适配器实现 (2天)
- [ ] **Web存储适配器**
  - [ ] `WebStorageAdapter.ts` - localStorage/sessionStorage封装
  - [ ] 实现缓存管理策略
  - [ ] 数据持久化处理

- [ ] **Web音频适配器**
  - [ ] `WebAudioEngine.ts` - 基于HTML5 Audio API
  - [ ] 实现Web Audio API集成
  - [ ] 跨域音频处理
  - [ ] 音频预加载优化

### 2.3 路由系统重构 (1天)
- [ ] **更新路由配置**
  - [ ] 使用shared包的路由配置
  - [ ] 优化React Router集成
  - [ ] 添加路由守卫和权限检查

### 2.4 UI组件系统重构 (5天)

#### 2.4.1 布局组件重构 (1.5天)
- [ ] **主布局组件**
  - [ ] `Layout.tsx` - 响应式布局重构
  - [ ] `Header.tsx` - 导航栏优化
  - [ ] `Sidebar.tsx` - 侧边栏适配
  - [ ] 移动端适配优化

#### 2.4.2 播放器组件重构 (2天)
- [ ] **播放控制组件**
  - [ ] `PlayerBar.tsx` - 播放控制栏
  - [ ] `ProgressBar.tsx` - 进度条组件
  - [ ] `VolumeControl.tsx` - 音量控制
  - [ ] `PlayModeControl.tsx` - 播放模式控制

- [ ] **队列和歌词组件**
  - [ ] `QueueSidebar.tsx` - 播放队列
  - [ ] `LyricsPanel.tsx` - 歌词显示面板
  - [ ] 歌词同步和滚动优化

#### 2.4.3 音乐展示组件重构 (1.5天)
- [ ] **列表和卡片组件**
  - [ ] `SongList.tsx` - 歌曲列表
  - [ ] `VirtualizedSongList.tsx` - 虚拟化列表
  - [ ] `SongCard.tsx` - 歌曲卡片
  - [ ] `PlaylistCard.tsx` - 歌单卡片
  - [ ] `AlbumCard.tsx` - 专辑卡片

### 2.5 页面组件重构 (3天)
- [ ] **核心页面重构**
  - [ ] `HomePage.tsx` - 首页发现
  - [ ] `SearchPage.tsx` - 搜索页面
  - [ ] `LibraryPage.tsx` - 音乐库页面
  - [ ] `PlaylistDetailPage.tsx` - 歌单详情
  - [ ] `PlaylistDetailPage.enhanced.tsx` - 增强版歌单详情
  - [ ] `LyricsPage.tsx` - 歌词页面
  - [ ] `StatsPage.tsx` - 统计页面
  - [ ] `RecentPage.tsx` - 最近播放
  - [ ] `SettingsPage.tsx` - 设置页面

### 2.6 认证和通用组件 (2天)
- [ ] **认证组件**
  - [ ] `LoginModal.tsx` - 登录模态框
  - [ ] `AuthGuard.tsx` - 路由守卫

- [ ] **通用组件优化**
  - [ ] `LoadingSpinner.tsx` - 加载指示器
  - [ ] `ErrorBoundary.tsx` - 错误边界
  - [ ] `Modal.tsx` - 通用模态框
  - [ ] `Button.tsx` - 按钮组件
  - [ ] `Input.tsx` - 输入组件

### 2.7 样式系统重构 (2天)
- [ ] **样式框架升级**
  - [ ] 集成Stitches或styled-components
  - [ ] 实现毛玻璃设计系统
  - [ ] 创建设计令牌 (Design Tokens)
  - [ ] 响应式断点系统

- [ ] **动画系统**
  - [ ] 集成Framer Motion
  - [ ] 创建过渡动画组件
  - [ ] 页面切换动画
  - [ ] 交互反馈动画

---

## 📱 阶段三：React Native平台开发 (4-5周)

### 3.1 React Native项目搭建 (packages/mobile) (2天)
- [ ] **初始化RN项目**
  - [ ] 创建Expo项目
  - [ ] 配置package.json和依赖
  - [ ] 设置TypeScript配置
  - [ ] 集成shared包

- [ ] **开发环境配置**
  - [ ] 配置Metro bundler
  - [ ] 设置开发脚本
  - [ ] 配置调试工具

### 3.2 平台适配器实现 (3天)
- [ ] **移动端存储适配器**
  - [ ] `MobileStorageAdapter.ts` - AsyncStorage封装
  - [ ] 实现数据持久化
  - [ ] 缓存管理策略

- [ ] **移动端音频适配器**
  - [ ] `MobileAudioEngine.ts` - 基于expo-av
  - [ ] 后台播放支持
  - [ ] 音频会话管理
  - [ ] 媒体控制集成

- [ ] **导航适配器**
  - [ ] `MobileNavigationAdapter.ts` - React Navigation集成
  - [ ] Tab导航配置
  - [ ] Stack导航设置
  - [ ] 深度链接支持

### 3.3 核心UI组件库 (6天)

#### 3.3.1 基础组件库 (2天)
- [ ] **通用组件重写**
  - [ ] `Button.tsx` - 原生按钮组件
  - [ ] `Input.tsx` - 原生输入组件
  - [ ] `Modal.tsx` - 原生模态框
  - [ ] `Loading.tsx` - 加载指示器
  - [ ] `Card.tsx` - 卡片组件

#### 3.3.2 导航组件 (1.5天)
- [ ] **导航结构**
  - [ ] `TabNavigator.tsx` - 底部Tab导航
  - [ ] `StackNavigator.tsx` - 页面栈导航
  - [ ] `HeaderBar.tsx` - 自定义导航栏
  - [ ] `BackButton.tsx` - 返回按钮

#### 3.3.3 播放器组件 (2.5天)
- [ ] **播放控制组件**
  - [ ] `MiniPlayer.tsx` - 迷你播放器
  - [ ] `FullPlayer.tsx` - 全屏播放器
  - [ ] `PlayerControls.tsx` - 播放控制
  - [ ] `SeekBar.tsx` - 进度条
  - [ ] `VolumeSlider.tsx` - 音量滑块

- [ ] **队列和歌词**
  - [ ] `PlayQueue.tsx` - 播放队列
  - [ ] `LyricsView.tsx` - 歌词显示
  - [ ] `LyricsScroller.tsx` - 歌词滚动

### 3.4 页面屏幕组件 (4天)
- [ ] **主要屏幕**
  - [ ] `HomeScreen.tsx` - 首页屏幕
  - [ ] `SearchScreen.tsx` - 搜索屏幕
  - [ ] `LibraryScreen.tsx` - 音乐库屏幕
  - [ ] `PlaylistScreen.tsx` - 歌单屏幕
  - [ ] `PlayerScreen.tsx` - 播放器屏幕
  - [ ] `LyricsScreen.tsx` - 歌词屏幕
  - [ ] `SettingsScreen.tsx` - 设置屏幕

### 3.5 音乐组件适配 (3天)
- [ ] **列表组件**
  - [ ] `SongList.tsx` - 歌曲列表 (FlatList)
  - [ ] `VirtualizedSongList.tsx` - 虚拟化列表
  - [ ] `SongItem.tsx` - 歌曲项目
  - [ ] `PlaylistGrid.tsx` - 歌单网格

- [ ] **卡片组件**
  - [ ] `SongCard.tsx` - 歌曲卡片
  - [ ] `PlaylistCard.tsx` - 歌单卡片
  - [ ] `AlbumCard.tsx` - 专辑卡片

### 3.6 手势和动画 (2天)
- [ ] **手势处理**
  - [ ] 滑动手势支持
  - [ ] 拖拽排序功能
  - [ ] 下拉刷新
  - [ ] 上拉加载

- [ ] **动画效果**
  - [ ] 页面转场动画
  - [ ] 组件进入/退出动画
  - [ ] 播放器动画效果
  - [ ] Loading动画

### 3.7 平台特性集成 (3天)
- [ ] **原生功能集成**
  - [ ] 推送通知配置
  - [ ] 后台播放设置
  - [ ] 锁屏控制
  - [ ] 媒体会话API
  - [ ] 本地文件扫描
  - [ ] 权限管理

---

## 🖥️ 阶段四：Electron桌面端支持 (2-3周)

### 4.1 Electron项目搭建 (packages/desktop) (1天)
- [ ] **初始化Electron项目**
  - [ ] 创建Electron主进程
  - [ ] 配置渲染进程
  - [ ] 集成Web包代码
  - [ ] 设置构建配置

### 4.2 桌面端特性 (3天)
- [ ] **桌面应用功能**
  - [ ] 窗口管理
  - [ ] 系统托盘集成
  - [ ] 快捷键支持
  - [ ] 自动更新机制
  - [ ] 文件关联

- [ ] **桌面端优化**
  - [ ] 性能优化
  - [ ] 内存管理
  - [ ] 安全策略配置

### 4.3 打包和分发 (2天)
- [ ] **应用打包**
  - [ ] electron-builder配置
  - [ ] 多平台构建 (Windows, macOS, Linux)
  - [ ] 代码签名设置
  - [ ] 安装包优化

---

## 🧪 阶段五：测试和质量保证 (2-3周)

### 5.1 单元测试 (4天)
- [ ] **共享代码测试**
  - [ ] API服务测试
  - [ ] 工具函数测试
  - [ ] 状态管理测试
  - [ ] 音频服务测试

- [ ] **组件测试**
  - [ ] Web组件测试
  - [ ] React Native组件测试
  - [ ] 跨平台组件一致性测试

### 5.2 集成测试 (3天)
- [ ] **端到端测试**
  - [ ] 用户流程测试
  - [ ] API集成测试
  - [ ] 跨页面导航测试
  - [ ] 播放流程测试

### 5.3 性能测试 (3天)
- [ ] **性能指标测试**
  - [ ] Web Vitals检测
  - [ ] 内存使用测试
  - [ ] 启动时间测试
  - [ ] 音频播放延迟测试

### 5.4 兼容性测试 (2天)
- [ ] **设备兼容性**
  - [ ] 不同浏览器测试
  - [ ] 移动设备适配测试
  - [ ] 不同屏幕尺寸测试
  - [ ] 操作系统兼容性

---

## 🚀 阶段六：优化和发布 (2-3周)

### 6.1 性能优化 (4天)
- [ ] **Bundle优化**
  - [ ] 代码分割优化
  - [ ] Tree shaking配置
  - [ ] 懒加载优化
  - [ ] 缓存策略

- [ ] **运行时优化**
  - [ ] 内存泄漏检查
  - [ ] 渲染性能优化
  - [ ] 网络请求优化
  - [ ] 音频播放优化

### 6.2 用户体验优化 (3天)
- [ ] **界面优化**
  - [ ] 响应式设计完善
  - [ ] 无障碍支持
  - [ ] 国际化支持
  - [ ] 主题系统完善

- [ ] **交互优化**
  - [ ] 手势优化
  - [ ] 动画流畅性
  - [ ] 加载状态优化
  - [ ] 错误处理优化

### 6.3 文档和部署 (3天)
- [ ] **技术文档**
  - [ ] API文档更新
  - [ ] 组件文档
  - [ ] 部署指南
  - [ ] 开发指南

- [ ] **发布准备**
  - [ ] 版本发布流程
  - [ ] CI/CD配置
  - [ ] 应用商店准备
  - [ ] 分发渠道配置

---

## 📊 进度追踪

### 完成状态统计
- **阶段一**: 0/23 项任务完成 (0%)
- **阶段二**: 0/35 项任务完成 (0%)
- **阶段三**: 0/32 项任务完成 (0%)
- **阶段四**: 0/8 项任务完成 (0%)
- **阶段五**: 0/12 项任务完成 (0%)
- **阶段六**: 0/10 项任务完成 (0%)

**总体进度**: 0/120 项任务完成 (0%)

### 里程碑时间节点
- [ ] **M1**: 共享代码包完成 - 预计第3周
- [ ] **M2**: Web平台重构完成 - 预计第7周
- [ ] **M3**: React Native平台完成 - 预计第12周
- [ ] **M4**: 测试和优化完成 - 预计第15周
- [ ] **M5**: 正式发布 - 预计第16周

---

## 🎯 关键成功指标

### 技术指标
- [ ] 代码复用率 ≥ 85%
- [ ] 包体积 ≤ 原项目的150%
- [ ] 启动时间 ≤ 3秒 (所有平台)
- [ ] 内存使用 ≤ 100MB (基础功能)

### 性能指标
- [ ] Web Vitals评分 ≥ 90
- [ ] 音频播放延迟 ≤ 100ms
- [ ] 页面切换时间 ≤ 300ms
- [ ] 大型歌单加载 ≤ 2秒

### 质量指标
- [ ] 单元测试覆盖率 ≥ 80%
- [ ] 0 Critical安全漏洞
- [ ] TypeScript严格模式通过
- [ ] 无障碍性评级 ≥ AA

---

## 📝 更新日志

### 更新说明
**每次完成任务后，请按以下格式更新：**

```markdown
### YYYY-MM-DD - 完成者姓名
- ✅ 完成任务: [具体任务描述]
- 📝 备注: [遇到的问题、解决方案、优化建议]
- ⏱️ 用时: [实际用时]
- 🔗 相关PR/Commit: [链接]
```

### 历史记录
> 暂无更新记录

---

## ⚠️ 风险提醒

### 高风险项
1. **音频引擎适配复杂度** - 不同平台API差异较大
2. **性能优化挑战** - 大型歌单在移动端的性能
3. **平台特性差异** - iOS/Android权限和后台播放限制

### 缓解策略
1. 提前进行技术验证和POC开发
2. 分阶段发布，优先保证核心功能
3. 建立完善的测试环境和流程

---

**📌 重要提醒**: 请严格按照此计划执行，每完成一项任务都要及时更新文档，确保项目进度可追踪！