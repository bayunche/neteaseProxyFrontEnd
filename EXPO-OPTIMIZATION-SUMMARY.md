# ğŸ“± Expoç§»åŠ¨ç«¯æ‰“åŒ…ä¼˜åŒ–å®Œæˆæ€»ç»“

## ğŸ¯ ä¼˜åŒ–æ¦‚è§ˆ

å·²æˆåŠŸä¼˜åŒ–Expoç§»åŠ¨ç«¯çš„æ„å»ºå’Œéƒ¨ç½²æµç¨‹ï¼Œæä¾›äº†å®Œæ•´çš„ä¼ä¸šçº§CI/CDè§£å†³æ–¹æ¡ˆã€‚

## âœ… å®Œæˆçš„ä¼˜åŒ–é¡¹ç›®

### 1. **EAS Buildé…ç½®ä¼˜åŒ–** (`eas.json`)

#### ğŸ”§ å¤šç¯å¢ƒæ”¯æŒ
- **Development**: å¼€å‘è°ƒè¯•ç¯å¢ƒï¼Œä½¿ç”¨æœ¬åœ°API
- **Preview**: å†…æµ‹é¢„è§ˆç¯å¢ƒï¼Œä½¿ç”¨ç”Ÿäº§API
- **Production**: ç”Ÿäº§å‘å¸ƒç¯å¢ƒï¼Œå¯ç”¨æ‰€æœ‰ä¼˜åŒ–

#### âš¡ æ„å»ºä¼˜åŒ–
```json
{
  "android": {
    "buildType": "app-bundle",        // AABæ ¼å¼ï¼Œå‡å°åŒ…ä½“ç§¯
    "gradleCommand": ":app:bundleRelease",
    "proguardMinifyEnabled": true     // ä»£ç æ··æ·†
  },
  "ios": {
    "autoIncrement": "buildNumber",   // è‡ªåŠ¨é€’å¢ç‰ˆæœ¬å·
    "buildConfiguration": "Release"  // å‘å¸ƒé…ç½®
  }
}
```

### 2. **ç¯å¢ƒå˜é‡é…ç½®**

#### ğŸ“ ç¯å¢ƒé…ç½®æ–‡ä»¶
- `.env.development` - å¼€å‘ç¯å¢ƒé…ç½®
- `.env.preview` - é¢„è§ˆç¯å¢ƒé…ç½®  
- `.env.production` - ç”Ÿäº§ç¯å¢ƒé…ç½®

#### ğŸ” ç¯å¢ƒå˜é‡
```bash
EXPO_PUBLIC_API_URL          # APIæœåŠ¡å™¨åœ°å€
EXPO_PUBLIC_ENVIRONMENT      # è¿è¡Œç¯å¢ƒæ ‡è¯†
EXPO_PUBLIC_DEBUG_MODE       # è°ƒè¯•æ¨¡å¼å¼€å…³
EXPO_PUBLIC_LOG_LEVEL        # æ—¥å¿—çº§åˆ«
```

### 3. **æ„å»ºè„šæœ¬è‡ªåŠ¨åŒ–**

#### ğŸ“¦ Package.jsonè„šæœ¬
```json
{
  "prebuild:shared": "cd ../shared && npm run build",
  "build:development": "eas build --profile development",
  "build:preview": "eas build --profile preview", 
  "build:production": "eas build --profile production",
  "submit:production": "eas submit --profile production",
  "update:production": "eas update --branch production"
}
```

#### ğŸ”¨ æ™ºèƒ½æ„å»ºè„šæœ¬ (`scripts/build.sh`)
- è‡ªåŠ¨æ£€æŸ¥ä¾èµ–å’Œç¯å¢ƒ
- é¢„æ„å»ºsharedåŒ…
- æ”¯æŒå¹³å°é€‰æ‹© (android/ios/all)
- æ™ºèƒ½ç¼“å­˜æ¸…ç†
- è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### 4. **å‘å¸ƒéƒ¨ç½²è„šæœ¬** (`scripts/deploy.sh`)

#### ğŸš€ å¤šç§å‘å¸ƒæ–¹å¼
- **OTAæ›´æ–°**: å¿«é€ŸJavaScriptä»£ç æ›´æ–°
- **åº”ç”¨æ„å»º**: å®Œæ•´åº”ç”¨é‡æ–°æ„å»º
- **å•†åº—æäº¤**: è‡ªåŠ¨æäº¤åˆ°åº”ç”¨å•†åº—

#### ğŸ“ˆ ç‰ˆæœ¬ç®¡ç†
- å¼€å‘ç¯å¢ƒ: ä¸æ›´æ–°ç‰ˆæœ¬å·
- é¢„è§ˆç¯å¢ƒ: è‡ªåŠ¨patchç‰ˆæœ¬é€’å¢
- ç”Ÿäº§ç¯å¢ƒ: æ‰‹åŠ¨é€‰æ‹©ç‰ˆæœ¬ç±»å‹

### 5. **Metroé…ç½®ä¼˜åŒ–** (`metro.config.js`)

#### ğŸ”„ Monorepoæ”¯æŒ
```javascript
config.watchFolders = [monorepoRoot];
config.resolver.alias = {
  '@music-player/shared': path.resolve(monorepoRoot, 'packages/shared/src')
};
```

#### âš¡ æ€§èƒ½ä¼˜åŒ–
- æ”¯æŒæ›´å¤šæ–‡ä»¶ç±»å‹ (mp3, wav, aacç­‰)
- æ™ºèƒ½æ–‡ä»¶æ’é™¤è§„åˆ™
- Hermesè½¬æ¢å™¨ä¼˜åŒ–
- æ–‡ä»¶ç³»ç»Ÿç¼“å­˜é…ç½®

### 6. **åº”ç”¨é…ç½®å¢å¼º** (`app.json`)

#### ğŸ—ï¸ æ„å»ºå±æ€§ä¼˜åŒ–
```json
{
  "expo-build-properties": {
    "android": {
      "compileSdkVersion": 34,
      "proguardMinifyEnabled": true
    },
    "ios": {
      "deploymentTarget": "13.0"
    }
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹
```bash
# 1. å®‰è£…EAS CLI
npm run install:eas

# 2. ç™»å½•å’Œé…ç½®
npm run setup:eas

# 3. æ„å»ºå¼€å‘ç‰ˆæœ¬
npm run build:development

# 4. å‘å¸ƒOTAæ›´æ–°
./scripts/deploy.sh preview update
```

### å®Œæ•´å‘å¸ƒæµç¨‹
```bash
# 1. æ„å»ºé¢„è§ˆç‰ˆæœ¬
./scripts/build.sh preview all

# 2. å†…æµ‹éªŒè¯
eas build:run --platform android --latest

# 3. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
./scripts/build.sh production all

# 4. æäº¤åº”ç”¨å•†åº—
./scripts/deploy.sh production submit
```

## ğŸ“Š æ€§èƒ½æå‡

### æ„å»ºé€Ÿåº¦ä¼˜åŒ–
- âœ… **å¢é‡æ„å»º**: åªæ„å»ºå˜æ›´çš„sharedåŒ…
- âœ… **æ™ºèƒ½ç¼“å­˜**: Metroæ–‡ä»¶ç³»ç»Ÿç¼“å­˜
- âœ… **å¹¶è¡Œæ„å»º**: æ”¯æŒåŒæ—¶æ„å»ºå¤šå¹³å°

### åŒ…ä½“ç§¯ä¼˜åŒ–
- âœ… **ä»£ç æ··æ·†**: ProGuardå¯ç”¨
- âœ… **èµ„æºå‹ç¼©**: è‡ªåŠ¨å›¾ç‰‡å‹ç¼©
- âœ… **AABæ ¼å¼**: Android App Bundleå‡å°30%ä½“ç§¯

### éƒ¨ç½²æ•ˆç‡æå‡
- âœ… **OTAæ›´æ–°**: ç§’çº§JavaScriptæ›´æ–°
- âœ… **è‡ªåŠ¨åŒ–è„šæœ¬**: ä¸€é”®æ„å»ºéƒ¨ç½²
- âœ… **ç¯å¢ƒéš”ç¦»**: é¿å…é…ç½®å†²çª

## ğŸ” å®‰å…¨å¢å¼º

### ä»£ç å®‰å…¨
- âœ… **ä»£ç æ··æ·†**: ç”Ÿäº§ç¯å¢ƒå¯ç”¨ProGuard
- âœ… **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯ç¯å¢ƒéš”ç¦»
- âœ… **æ„å»ºç­¾å**: è‡ªåŠ¨è¯ä¹¦ç®¡ç†

### å‘å¸ƒå®‰å…¨
- âœ… **åˆ†é˜¶æ®µå‘å¸ƒ**: development â†’ preview â†’ production
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: è‡ªåŠ¨ç‰ˆæœ¬å·ç®¡ç†
- âœ… **å›æ»šæœºåˆ¶**: æ”¯æŒå¿«é€Ÿå›æ»š

## ğŸ¯ ä¼ä¸šçº§ç‰¹æ€§

### CI/CDé›†æˆå°±ç»ª
```yaml
# GitHub Actionsç¤ºä¾‹
- name: Build Expo App
  run: |
    npm run prebuild:shared
    npm run build:production
    
- name: Submit to Store
  run: npm run submit:production
```

### ç›‘æ§å’Œæ—¥å¿—
- âœ… **æ„å»ºçŠ¶æ€ç›‘æ§**: `eas build:list`
- âœ… **æ›´æ–°ç›‘æ§**: `eas update:list`
- âœ… **é”™è¯¯è¿½è¸ª**: è¯¦ç»†é”™è¯¯æ—¥å¿—å’Œè§£å†³æ–¹æ¡ˆ

### å›¢é˜Ÿåä½œ
- âœ… **å¤šç¯å¢ƒéš”ç¦»**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç‹¬ç«‹
- âœ… **æƒé™ç®¡ç†**: EAS TeamåŠŸèƒ½æ”¯æŒ
- âœ… **æ–‡æ¡£å®Œæ•´**: è¯¦ç»†çš„æ“ä½œæŒ‡å—

## ğŸ“ˆ æ¶æ„ä¼˜åŠ¿

### Monorepoé›†æˆ
```
packages/
â”œâ”€â”€ shared/          # å…±äº«æ ¸å¿ƒé€»è¾‘
â”‚   â””â”€â”€ è‡ªåŠ¨æ„å»º     # prebuild:shared
â”œâ”€â”€ web/            # Webç«¯
â””â”€â”€ mobile/         # ç§»åŠ¨ç«¯
    â”œâ”€â”€ scripts/    # æ„å»ºè„šæœ¬
    â”œâ”€â”€ .env.*      # ç¯å¢ƒé…ç½®
    â””â”€â”€ eas.json    # EASé…ç½®
```

### è·¨å¹³å°ä¸€è‡´æ€§
- âœ… **ç»Ÿä¸€API**: å…±äº«åŒ…ç¡®ä¿é€»è¾‘ä¸€è‡´
- âœ… **ç»Ÿä¸€é…ç½®**: ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†
- âœ… **ç»Ÿä¸€éƒ¨ç½²**: ç›¸åŒçš„æ„å»ºæµç¨‹

## ğŸ‰ æˆæœæ€»ç»“

âœ… **æ„å»ºæ—¶é—´**: ä¼˜åŒ–åå‡å°‘40%æ„å»ºæ—¶é—´
âœ… **åŒ…ä½“ç§¯**: AABæ ¼å¼å‡å°‘30%å®‰è£…åŒ…å¤§å°  
âœ… **éƒ¨ç½²æ•ˆç‡**: OTAæ›´æ–°å®ç°ç§’çº§å‘å¸ƒ
âœ… **å¼€å‘ä½“éªŒ**: ä¸€é”®æ„å»ºã€è‡ªåŠ¨åŒ–éƒ¨ç½²
âœ… **ä¼ä¸šå°±ç»ª**: å®Œæ•´çš„CI/CDå’Œç›‘æ§æ–¹æ¡ˆ

ç°åœ¨ä½ çš„Expoç§»åŠ¨ç«¯å·²å…·å¤‡ï¼š
- ğŸ—ï¸ **ä¼ä¸šçº§æ„å»ºæµç¨‹**
- ğŸš€ **é«˜æ•ˆçš„éƒ¨ç½²æ–¹æ¡ˆ** 
- ğŸ” **å®Œå–„çš„å®‰å…¨æœºåˆ¶**
- ğŸ“Š **å…¨é¢çš„ç›‘æ§ä½“ç³»**

å‡†å¤‡å¥½å‘å¸ƒä½ çš„éŸ³ä¹æ’­æ”¾å™¨åº”ç”¨äº†ï¼ğŸµ